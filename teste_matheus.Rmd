---
title: "Análise da precificação de casas nos EUA"
author:
  - Ana Beatriz
  - Andre Palacio
  - Lucas Garcia
  - Matheus Salermo
  - Matheus Rocha
  - Raphael Ghidella
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Seleção do dataset
Escolhemos o conjunto de dados do Kaggle: [House Sales in King County, USA](https://www.kaggle.com/datasets/harlfoxem/housesalesprediction). Esse dataset contém preços de venda de casas em King County, um condado dos Estados Unidos que inclui a cidade de Seattle, entre maio de 2014 e maio de 2015.

## Alguns preparos
Antes de começar a análise precisamos de algumas bibliotecas para facilitar nosso trabalho:
```{r, results = 'hide'}
# Instala (se necessário) e carrega as bibliotecas usadas
load <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg))
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
} 

packages <- c("dplyr", "ggplot2")
load(packages)
```

Agora vamos carregar nosso dataset:
```{r}
df <- read.csv("./kc_house_data.csv")
```

## Visão geral dos dados
Vamos entender um pouco sobre o conjunto de dados escolhido. O dataset abrange uma variedade de características residenciais, como o número de quartos em cada casa, a área das casas e dos terrenos, a presença de vista para a água, a condição das casas, a classificação atribuída pelo condado, os anos de construção e de renovação, além da localização das casas.

Para começar vamos dar uma olhada no tamanho desse conjunto de dados:
```{r}
glimpse(df)
```
Como você pode ver o dataset tem 21.612 registros mensurados com 21 diferentes variáveis.

Agora vamos procurar por valores ausentes no dataframe.
```{r}
# Contar os dados N/A em cada coluna do dataframe 'df'
qtd_na <- df %>%
  summarise_all(~ sum(is.na(.)))

# Exibir o resultado
qtd_na
```
O bloco de código anterior verificou cada coluna do datafram e calculou a quantidade de valores ausentes (NA) em cada uma delas. O resultado é então exibido, como podemos ver não tem nenhum valor faltante.

## ANOVA
Esta seção examina se existe uma diferença estatística entre a média do preço de venda das casas de acordo com a classificação de condição atribuída às casas.
### Hipóteses:
- H0: A média de preço é igual para todas as categorias de condição.
- H1: Pelo menos uma das categorias de condição tem uma média de preço diferente das outras categorias de condição.

O p-valor da variável `condition` (referente à condição da casa) é baixo (p < 0,001, indicado por '***'), o que implica que a classificação de condição tem impacto no preço de venda das casas. Portanto, a H0 é rejeitada.

```{r}
df$condition = factor(df$condition)

model <- aov(price ~ condition, data = df)
summary(model)
```


### Teste de Shapiro-Wilk
O teste de Shapiro-Wilk não foi utilizado devido ao tamanho do nosso conjunto de dados. Por definição, esse teste não é aplicado em conjuntos de dados grandes, uma vez que, quanto maior o grau de liberdade, menor se torna o valor crítico. Isso significa que a probabilidade de rejeitar a hipótese nula se torna extremamente significativa, a ponto de o próprio interpretador do R não executar a função.

### Teste de Tukey

Com base nos resultados do teste, existem diferenças estatisticamente significativas (p < 0,05) entre os grupos de condição 3-1 (3 e 1), 5-1, 3-2, 4-2, 5-2, 4-3, 5-3 e 5-4. A diferença entre os grupos de condição 2-1 e 4-1 não é estatisticamente significativa.

```{r}
TukeyHSD(model, "condition", ordered= TRUE)
```

## Regressão linear

```{r}
model <- lm(price ~ bedrooms, data = df)
summary(model)
```

O R-quadrado múltiplo (R²) de 0.09951 indica que aproximadamente 9,95% da variabilidade nos preços das casas (price) pode ser explicada pelo número de quartos (bedrooms). O R-quadrado ajustado, que considera o número de preditores no modelo, oferece uma medida semelhante.

O valor F de 2388 e o valor-p extremamente baixo (<<2.2e-16) indicam que o modelo como um todo é estatisticamente significativo.

Resumindo, o número de quartos (bedrooms) tem um impacto estatisticamente significativo nos preços das casas (price) de acordo com o modelo de regressão linear ajustado. No entanto, é importante notar que o R-quadrado é relativamente baixo, sugerindo que o número de quartos por si só explica apenas uma pequena parte da variabilidade nos preços das casas. Outros fatores não incluídos no modelo podem ter uma influência significativa nos preços das casas.

### Plotando os gráficos da regressão linear
```{r}
ggplot(df, aes(x=bedrooms, y=price)) + geom_point() + 
  geom_smooth(method = "lm", se = FALSE, color = "blue") + 
  labs(x = "bedrooms", y = "Price") + ggtitle("Regressão linear")

plot(model)
```

## Análise dos resíduos
```{r}
# Calcular os resíduos do modelo
residuos <- resid(model)

# Resumo estatístico dos resíduos
summary(residuos)

# Gráfico Q-Q plot para verificar a normalidade dos resíduos
qqnorm(residuos)
qqline(residuos)

# Gráfico de dispersão dos resíduos em relação à variável `Preço`
plot(df$price, residuos, main = "Dispersão dos Resíduos vs. Preço",
     xlab = "Preço", ylab = "Resíduos")
```

A análise dos resíduos fornece informações sobre a distribuição dos erros do modelo, isso representa a diferença entre a previsão e os dados reais. A média do modelo em questão é igual a zero, indicando que os erros se aproximam desse valor, implicando em uma previsão similar aos dados reais. Além disso, os resíduos devem seguir aproximadamente uma distribuição normal, o que é nítido no Q-Q plot.
